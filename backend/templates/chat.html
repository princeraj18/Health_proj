<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Medical Chatbot</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
<div class="chat-container">

    <div class="chat-header">
        ðŸ©º Medical Chatbot
    </div>

    <div id="chatBox" class="chat-body"></div>

    <div class="chat-footer">
        <select id="mode" class="form-control mode-select">
            <option value="report">Report Summary</option>
            <option value="nutrition">Nutrition</option>
            <option value="medicine">Medicine</option>
            <option value="disease">Disease</option>
        </select>

        <form id="chatForm" enctype="multipart/form-data">
            <input type="file" id="report" name="report" class="form-control mb-2">
            <input type="text" id="msg" name="msg" placeholder="Type your message..." class="form-control" required>
            <button class="btn btn-primary btn-block mt-2">Send</button>
        </form>
    </div>

</div>

<script>
$("#chatForm").submit(function(e){
    e.preventDefault();

    let mode = $("#mode").val();
    let formData = new FormData(this);

    let userMsg = $("#msg").val();
    $("#msg").val("");

    $("#chatBox").append(`<div class="user-msg">${userMsg}</div>`);

    $.ajax({
        url: "/api/" + mode,
        type: "POST",
        data: formData,
        processData: false,
        contentType: false,
        success: function(res){
            $("#chatBox").append(`<div class="bot-msg">${res.answer.replace(/\n/g,"<br>")}</div>`);
            $("#chatBox").scrollTop($("#chatBox")[0].scrollHeight);
        },
        error: function(){
            alert("Something went wrong");
        }
    });
});
</script>

</body>
</html>
